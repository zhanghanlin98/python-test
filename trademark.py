import threading
import cx_Oracle

city = {"广州" : [
'440190',
'440112',
'440105',
'440185',
'440191',
'440188',
'440116',
'440100',
'440103',
'440193',
'440113',
'440184',
'440195',
'440183',
'440106',
'440111',
'440115',
'440104',
'440114'], "深圳":['440304',
'441283',
'440303',
'440305',
'440308',
'440307',
'440309',
'440300',
'440306'], "东莞":['441900','0'], "佛山":['440600',
'440604',
'440605',
'440606',
'440607',
'440608'], "珠海":['440400',
'440402',
'440403',
'440404'], "惠州":['441340',
'441300',
'441324',
'441303',
'441322',
'441302',
'441323'], "中山":['442000','0'],
"茂名":['440923',
'440900',
'440902',
'440981'], "湛江":['440800',
'440811',
'440803',
'440883',
'440802',
'440804',
'440823'] , "河源":['441600',
'441622',
'441621',
'441623',
'441625',
'441602',
'441624'], "肇庆":['441226',
'441283',
'441202',
'441225',
'441223',
'441240',
'441200',
'441203'], "阳江":['441723',
'441780',
'441742',
'441721',
'441702',
'441700'], "汕头":['440500',
'440511',
'440515',
'440514',
'440513',
'440523',
'440512'], "潮州":['445100',
'445122',
'445102',
'445103'], "汕尾":['441502',
'441542',
'441521',
'441580',
'441540',
'441523',
'441500'], "梅州":['441422',
'441481',
'441424',
'441400',
'441427',
'441421',
'441423',
'441402'], "云浮":['445323',
'445302',
'445300',
'445321',
'445322'],"揭阳":['445281',
'445202',
'445222',
'445224',
'445203',
'445243',
'445200'], "韶关":['440200',
'440224',
'440205',
'440233',
'440281',
'440203',
'440232',
'440204',
'440222'], "江门":['440703',
'440705',
'440700',
'440785',
'440704'], "清远":['441826',
'441802',
'441800',
'441803',
'441823']}

start_date = '2020-01-01'
end_date = '2020-07-01'

city_names = []
result = []

def select():
    for city_name in city:
        city_names.append(city_name)

    conn = cx_Oracle.connect('TMU_FENFA', '0123456', '10.1.1.81/tsfa')
    cur = conn.cursor()

    for value in city.values():
        sql = "select count(DISTINCT(a.REG_NUM)) from GD_4400_TM_HOLDERINFO a, GD_4400_TM_REGBASEINFO b where a.REG_NUM=b.REG_NUM and b.APP_DATE>=to_date('{0}','yyyy-mm-dd') and b.APP_DATE<to_date('{1}','yyyy-mm-dd') and a.REG_REGIONALISM_ID in {2}".format(start_date, end_date, tuple(value))

        cur.execute(sql)
        result.append(cur.fetchone()[0])

    for m,n in zip(city_names, result):
        print(m ,  n)


if __name__ == "__main__":
    select()





